name: Java CI with Maven

on:
  push:
    branches: [ "master" ] # Runs on pushes to the 'master' branch
  pull_request:
    branches: [ "master" ] # Runs on pull requests targeting the 'master' branch

permissions:
  contents: read  # Allows checkout action to read repository content
  checks: write   # Allows test reporter to write check runs

jobs:
  build-and-test:

    runs-on: ubuntu-latest

    steps:
      # Checks-out the repository under $GITHUB_WORKSPACE, so the job can access it
      - name: Checkout code
        uses: actions/checkout@v4

      # Sets up JDK 21 using Corretto distribution and caches Maven dependencies
      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'corretto'
          cache: maven

      # Run Maven tests (and build). 'verify' runs tests and other checks.
      # The build will fail if tests fail.
      - name: Build and run tests with Maven
        run: mvn --batch-mode verify

      # (Optional) Upload test reports as artifacts to view/download
      - name: Upload test reports
        if: always() # Run this even if the 'verify' step fails
        uses: actions/upload-artifact@v4
        with:
          name: surefire-reports
          path: target/surefire-reports/

      # (Optional) Use the test reporter action to summarise results in the Actions UI
      - name: Report test results
        uses: dorny/test-reporter@v1
        if: always() # Always run this step to report, success/failure is determined by the 'verify' step
        with:
          name: Maven Tests # Name of the check run which will be created
          path: target/surefire-reports/*.xml # Path to test results (Surefire default)
          reporter: java-junit # Format of test results
          # fail-on-error: true # You might remove this - let the 'mvn verify' step handle the failure status
      - name: Generate Javadoc
        run: mvn javadoc:javadoc
      - name: Publish Javadoc
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: target/docs/javadoc